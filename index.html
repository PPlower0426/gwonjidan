<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>권지단 어휘대전</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-analytics-compat.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; touch-action: manipulation; }
        html, body { width: 100%; height: 100%; overflow: hidden; font-family: 'Inter', sans-serif; background: #0a0a0f; color: #fff; position: fixed; }
        .game-container { width: 100%; height: 100vh; height: -webkit-fill-available; max-width: 500px; margin: 0 auto; display: flex; flex-direction: column; background: #0a0a0f; overflow: hidden; }
    </style>
</head>
<body>
    <!-- 게임 컨테이너 -->
    <div class="game-container">
        
        <!-- 고밀도 헤더 (스테이지 + 점수 + 체력 통합) -->
        <div class="game-header">
            <div class="header-left">
                <span class="game-logo">⚔️ 권지단</span>
                <div class="stage-display">
                    <span class="stage-label">STAGE</span>
                    <span class="stage-value" id="currentStage">1</span>
                    <span class="stage-slash">/</span>
                    <span class="stage-total">10</span>
                </div>
            </div>
            
            <div class="header-center">
                <!-- 컴팩트 체력바 -->
                <div class="compact-health">
                    <div class="compact-hp monster-hp">
                        <div class="hp-icon">👹</div>
                        <div class="hp-bar-container">
                            <div class="hp-bar-fill monster-bar" id="compactMonsterHp"></div>
                        </div>
                        <div class="hp-text" id="compactMonsterHpText">100</div>
                    </div>
                    <div class="vs-mini">⚔️</div>
                    <div class="compact-hp player-hp">
                        <div class="hp-text" id="compactPlayerHpText">100</div>
                        <div class="hp-bar-container">
                            <div class="hp-bar-fill player-bar" id="compactPlayerHp"></div>
                        </div>
                        <div class="hp-icon">👤</div>
                    </div>
                </div>
            </div>
            
            <div class="header-right">
                <div class="score-display">
                    <span class="score-icon">⭐</span>
                    <span class="score-value" id="currentScore">0</span>
                </div>
                <button class="icon-btn ranking-header-btn" id="headerRankingBtn" title="랭킹">
                    <i class="fas fa-trophy"></i>
                </button>
                <button class="menu-btn" id="pauseBtn"><i class="fas fa-bars"></i></button>
            </div>
        </div>
        
        <!-- 초고밀도 대결 영역 -->
        <div class="battle-area">
            <!-- 몬스터 측 -->
            <div class="combatant monster-side">
                <div class="combatant-info">
                    <div class="combatant-level" id="monsterLevel">Lv.1</div>
                    <div class="combatant-name" id="monsterNameDisplay">초급 몬스터</div>
                </div>
                <div class="combatant-avatar">
                    <div class="avatar-circle monster-circle">
                        <div class="monster-avatar" id="monsterAvatar">👹</div>
                    </div>
                    <!-- 인라인 체력바 (아바타 바로 아래) -->
                    <div class="inline-health monster-health">
                        <div class="inline-hp-text" id="inlineMonsterHpText">100/100</div>
                        <div class="inline-hp-bar-container">
                            <div class="inline-hp-bar-fill monster-bar" id="inlineMonsterHp"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 중앙 대결 정보 -->
            <div class="battle-center">
                <div class="center-stats">
                    <div class="stat-item">
                        <div class="stat-icon">🔥</div>
                        <div class="stat-value" id="comboStat">0</div>
                        <div class="stat-label">콤보</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-icon">⏱️</div>
                        <div class="stat-value" id="timeStat">10</div>
                        <div class="stat-label">시간</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-icon">🎯</div>
                        <div class="stat-value" id="accuracyStat">100%</div>
                        <div class="stat-label">정확도</div>
                    </div>
                </div>
                <div class="center-vs">
                    <div class="vs-glow">⚔️</div>
                </div>
            </div>
            
            <!-- 플레이어 측 -->
            <div class="combatant player-side">
                <div class="combatant-info">
                    <div class="combatant-name">YOU</div>
                    <div class="combatant-level">👤</div>
                </div>
                <div class="combatant-avatar">
                    <div class="avatar-circle player-circle">
                        <div class="player-avatar" id="playerAvatar">👤</div>
                    </div>
                    <!-- 인라인 체력바 (아바타 바로 아래) -->
                    <div class="inline-health player-health">
                        <div class="inline-hp-text" id="inlinePlayerHpText">100/100</div>
                        <div class="inline-hp-bar-container">
                            <div class="inline-hp-bar-fill player-bar" id="inlinePlayerHp"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 중앙 대사 (말풍선) -->
            <div class="center-speech">
                <div class="speech-bubble" id="monsterSpeech">
                    <div class="speech-content">너를 이기고 말겠다!</div>
                </div>
            </div>
        </div>
        
        <!-- 고밀도 문제 카드 -->
        <div class="problem-card">
            <div class="card-header">
                <div class="card-title">
                    <i class="fas fa-keyboard"></i>
                    <span>어휘 문제</span>
                    <span class="length-badge" id="wordLengthBadge">2글자</span>
                </div>
                <div class="card-time">
                    <div class="time-display">
                        <i class="fas fa-clock"></i>
                        <span class="time-text" id="timeText">10초</span>
                    </div>
                </div>
            </div>
            
            <div class="card-body">
                <!-- 초성 힌트 -->
                <div class="hint-section">
                    <div class="hint-label">초성 힌트</div>
                    <div class="initial-display" id="initialDisplay">ㄱㅇ</div>
                    <div class="length-indicator" id="lengthIndicator">
                        <span class="dot active"></span>
                        <span class="dot active"></span>
                        <span class="dot"></span>
                        <span class="dot"></span>
                        <span class="dot"></span>
                    </div>
                </div>
                
                <!-- 뜻 설명 -->
                <div class="meaning-section">
                    <div class="meaning-label">뜻 설명</div>
                    <div class="meaning-display" id="meaningDisplay">병원체가 몸속에 들어와 번식하는 것</div>
                </div>
            </div>
            
            <div class="card-footer">
                <div class="input-guide">
                    <i class="fas fa-info-circle"></i>
                    <span>2~5글자 입력 가능 • 천지인(·) 포함 가능</span>
                </div>
            </div>
        </div>
        
        <!-- 입력 인터페이스 -->
        <div class="input-area">
            <div class="input-container">
                <div class="input-field">
                    <input type="text" 
                           id="wordInput" 
                           class="word-input"
                           maxlength="5"
                           placeholder="2~5글자 입력"
                           autocapitalize="none"
                           autocorrect="off"
                           spellcheck="false"
                           autocomplete="off">
                </div>
                
                <div class="input-actions">
                    <button class="icon-btn clear-btn" id="clearBtn" title="지우기">
                        <i class="fas fa-eraser"></i>
                    </button>
                    
                    <button class="icon-btn potion-btn" id="potionBtn" title="물약 사용">
                        <i class="fas fa-flask"></i>
                        <span class="potion-count" id="potionCount">3</span>
                    </button>
                    
                    <button class="icon-btn submit-btn" id="submitBtn" title="정답 제출">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- 모든 오버레이 화면 (변경 없음) -->
        <!-- 시작 화면 -->
        <div class="overlay start-screen">
            <div class="overlay-content">
                <div class="welcome-screen">
                    <div class="title-section">
                        <div class="title-icon">⚔️</div>
                        <h1>권지단</h1>
                        <h2>어휘대전</h2>
                    </div>
                    
                    <div class="welcome-message">
                        <p>초성과 뜻을 보고 단어를 맞춰<br>몬스터를 물리치는 고밀도 어휘 대결!</p>
                    </div>
                    
                    <div class="game-features">
                        <div class="feature"><span>🎯</span> 2~5글자 고급어휘</div>
                        <div class="feature"><span>⚔️</span> 10단계 대결</div>
                        <div class="feature"><span>🔥</span> 콤보 시스템</div>
                        <div class="feature"><span>🧪</span> 물약 회복</div>
                        <div class="feature"><span>🏆</span> 실시간 랭킹</div>
                        <div class="feature"><span>👤</span> 닉네임 설정</div>
                    </div>
                    
                    <button class="start-button" id="startBtn">
                        <i class="fas fa-play"></i> 대결 시작
                    </button>
                    
                    <button class="btn secondary ranking-button" id="rankingBtn" style="margin-bottom: 12px;">
                        <i class="fas fa-trophy"></i> 랭킹 보기
                    </button>
                    
                    <div class="game-guide">
                        <h3><i class="fas fa-graduation-cap"></i> 게임 방법</h3>
                        <ol>
                            <li>초성과 뜻을 보고 2~5글자 단어 입력</li>
                            <li>정답 → 몬스터 공격 / 오답 → 플레이어 피해</li>
                            <li>콤보 유지 시 강력한 공격</li>
                            <li>물약으로 체력 회복 가능</li>
                            <li>10단계 몬스터 물리치면 승리!</li>
                            <li>닉네임 설정 후 랭킹에 기록 등록</li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 닉네임 설정 화면 -->
        <div class="overlay nickname-screen">
            <div class="overlay-content">
                <div class="nickname-header">
                    <div class="nickname-icon">👤</div>
                    <h2>닉네임 설정</h2>
                    <p class="nickname-sub">랭킹에 표시될 이름을 입력하세요</p>
                </div>
                
                <div class="nickname-input-section">
                    <input type="text" 
                           id="nicknameInput" 
                           class="nickname-input"
                           maxlength="10"
                           placeholder="최대 10자"
                           autocapitalize="none"
                           autocorrect="off">
                    <div class="nickname-counter">
                        <span id="nicknameCount">0</span>/10
                    </div>
                </div>
                
                <div class="nickname-notice">
                    <i class="fas fa-info-circle"></i> 동일 기기에서는 한 번만 입력합니다
                </div>
                
                <button class="btn primary" id="saveNicknameBtn">
                    <i class="fas fa-save"></i> 저장하고 계속하기
                </button>
                
                <button class="btn secondary" id="skipNicknameBtn">
                    <i class="fas fa-forward"></i> 건너뛰기
                </button>
            </div>
        </div>
        
        <!-- 일시정지 화면 -->
        <div class="overlay pause-screen">
            <div class="overlay-content">
                <div class="pause-header">
                    <i class="fas fa-pause"></i>
                    <h2>대결 일시정지</h2>
                </div>
                
                <div class="pause-stats">
                    <div class="pause-stat">
                        <div class="stat-icon">⚔️</div>
                        <div class="stat-info">
                            <div class="stat-label">스테이지</div>
                            <div class="stat-value" id="pauseStage">Lv.1</div>
                        </div>
                    </div>
                    <div class="pause-stat">
                        <div class="stat-icon">⭐</div>
                        <div class="stat-info">
                            <div class="stat-label">점수</div>
                            <div class="stat-value" id="pauseScore">0</div>
                        </div>
                    </div>
                    <div class="pause-stat">
                        <div class="stat-icon">🔥</div>
                        <div class="stat-info">
                            <div class="stat-label">콤보</div>
                            <div class="stat-value" id="pauseCombo">0</div>
                        </div>
                    </div>
                    <div class="pause-stat">
                        <div class="stat-icon">🧪</div>
                        <div class="stat-info">
                            <div class="stat-label">물약</div>
                            <div class="stat-value" id="pausePotion">3</div>
                        </div>
                    </div>
                </div>
                
                <div class="pause-actions">
                    <button class="btn primary" id="resumeBtn">
                        <i class="fas fa-play"></i> 계속하기
                    </button>
                    <button class="btn secondary" id="restartBtn">
                        <i class="fas fa-redo"></i> 다시하기
                    </button>
                </div>
            </div>
        </div>
        
        <!-- 랭킹 화면 -->
        <div class="overlay ranking-screen">
            <div class="overlay-content">
                <div class="ranking-header">
                    <div class="ranking-icon">🏆</div>
                    <h2>랭킹</h2>
                    <p class="ranking-sub">전체 상위 10명</p>
                </div>
                
                <div class="ranking-controls">
                    <button class="ranking-tab active" data-type="score">최고 점수</button>
                    <button class="ranking-tab" data-type="stage">최고 단계</button>
                    <button class="ranking-tab" data-type="combo">최고 콤보</button>
                </div>
                
                <div class="ranking-list" id="rankingList">
                    <div class="loading-rankings">
                        <i class="fas fa-spinner fa-spin"></i> 랭킹 로딩 중...
                    </div>
                </div>
                
                <div class="my-ranking" id="myRanking">
                    <div class="my-ranking-header">내 랭킹</div>
                    <div class="my-ranking-info">
                        <div class="my-rank-details">
                            <div class="my-rank-name">게임을 플레이하면 랭킹에 등록됩니다</div>
                            <div class="my-rank-score">아직 기록이 없습니다</div>
                        </div>
                    </div>
                </div>
                
                <div class="ranking-actions">
                    <button class="btn secondary" id="refreshRankingBtn">
                        <i class="fas fa-sync"></i> 새로고침
                    </button>
                    <button class="btn primary" id="closeRankingBtn">
                        <i class="fas fa-times"></i> 닫기
                    </button>
                </div>
            </div>
        </div>
        
        <!-- 승리 화면 -->
        <div class="overlay result-screen win-screen">
            <div class="overlay-content">
                <div class="result-header">
                    <div class="result-icon">🏆</div>
                    <h2>대결 승리!</h2>
                    <p class="result-sub">모든 몬스터 물리침</p>
                </div>
                
                <div class="result-stats">
                    <div class="result-stat">
                        <div class="stat-icon">⭐</div>
                        <div class="stat-info">
                            <div class="stat-label">최종 점수</div>
                            <div class="stat-value" id="finalScore">0</div>
                        </div>
                    </div>
                    <div class="result-stat">
                        <div class="stat-icon">🔥</div>
                        <div class="stat-info">
                            <div class="stat-label">최고 콤보</div>
                            <div class="stat-value" id="finalCombo">0</div>
                        </div>
                    </div>
                    <div class="result-stat">
                        <div class="stat-icon">🎯</div>
                        <div class="stat-info">
                            <div class="stat-label">정확도</div>
                            <div class="stat-value" id="finalAccuracy">100%</div>
                        </div>
                    </div>
                    <div class="result-stat">
                        <div class="stat-icon">⏱️</div>
                        <div class="stat-info">
                            <div class="stat-label">클리어 시간</div>
                            <div class="stat-value" id="finalTime">0초</div>
                        </div>
                    </div>
                </div>
                
                <div class="victory-message">
                    <p>축하합니다! 어휘 실력이 대단하네요!<br>랭킹에 기록이 저장되었습니다.</p>
                </div>
                
                <button class="btn primary" id="playAgainBtn">
                    <i class="fas fa-redo"></i> 다시하기
                </button>
                
                <button class="btn secondary" id="viewRankingFromWinBtn" style="margin-top: 8px;">
                    <i class="fas fa-trophy"></i> 랭킹 보기
                </button>
            </div>
        </div>
        
        <!-- 패배 화면 -->
        <div class="overlay result-screen lose-screen">
            <div class="overlay-content">
                <div class="result-header">
                    <div class="result-icon">💀</div>
                    <h2>대결 패배</h2>
                    <p class="result-sub">체력 소진</p>
                </div>
                
                <div class="result-stats">
                    <div class="result-stat">
                        <div class="stat-icon">⭐</div>
                        <div class="stat-info">
                            <div class="stat-label">획득 점수</div>
                            <div class="stat-value" id="loseScore">0</div>
                        </div>
                    </div>
                    <div class="result-stat">
                        <div class="stat-icon">🔥</div>
                        <div class="stat-info">
                            <div class="stat-label">최고 콤보</div>
                            <div class="stat-value" id="loseCombo">0</div>
                        </div>
                    </div>
                    <div class="result-stat">
                        <div class="stat-icon">🎯</div>
                        <div class="stat-info">
                            <div class="stat-label">클리어 단계</div>
                            <div class="stat-value" id="loseStage">1/10</div>
                        </div>
                    </div>
                    <div class="result-stat">
                        <div class="stat-icon">⚔️</div>
                        <div class="stat-info">
                            <div class="stat-label">남은 몬스터</div>
                            <div class="stat-value" id="loseMonsters">9마리</div>
                        </div>
                    </div>
                </div>
                
                <div class="defeat-message">
                    <p>아쉽네요! 어휘 실력을 더 키워서 다시 도전하세요!<br>랭킹에 기록이 저장되었습니다.</p>
                </div>
                
                <button class="btn primary" id="restartFromLoseBtn">
                    <i class="fas fa-redo"></i> 다시 도전
                </button>
                
                <button class="btn secondary" id="viewRankingFromLoseBtn" style="margin-top: 8px;">
                    <i class="fas fa-trophy"></i> 랭킹 보기
                </button>
            </div>
        </div>
        
        <!-- 이펙트 레이어 -->
        <div class="effects-layer"></div>
        <div class="damage-layer"></div>
        
    </div>
    
    <!-- 사운드 요소들 -->
    <audio id="soundCorrect" preload="auto">
        <source src="sounds/correct.mp3" type="audio/mpeg">
    </audio>
    <audio id="soundWrong" preload="auto">
        <source src="sounds/wrong.mp3" type="audio/mpeg">
    </audio>
    <audio id="soundDamage" preload="auto">
        <source src="sounds/damage.mp3" type="audio/mpeg">
    </audio>
    <audio id="soundHit" preload="auto">
        <source src="sounds/hit.mp3" type="audio/mpeg">
    </audio>
    <audio id="soundCombo" preload="auto">
        <source src="sounds/combo.mp3" type="audio/mpeg">
    </audio>
    <audio id="soundVictory" preload="auto">
        <source src="sounds/victory.mp3" type="audio/mpeg">
    </audio>
    <audio id="soundPotion" preload="auto">
        <source src="sounds/potion.mp3" type="audio/mpeg">
    </audio>
    
    <!-- 게임 로직 -->
    <script src="game.js"></script>
    
    <!-- Firebase 설정 및 초기화 -->
    <script>
    // Firebase 구성 정보 - gwonjidanwords 프로젝트
    const firebaseConfig = {
        apiKey: "AIzaSyApBB-QuQBOImgysqbfeffYBowEeERYRS4",
        authDomain: "gwonjidanwords.firebaseapp.com",
        databaseURL: "https://gwonjidanwords-default-rtdb.asia-southeast1.firebasedatabase.app/",
        projectId: "gwonjidanwords",
        storageBucket: "gwonjidanwords.firebasestorage.app",
        messagingSenderId: "602593593346",
        appId: "1:602593593346:web:17eeaba9ac91100942ff1b",
        measurementId: "G-GRW0CC74MP"
    };

    // Firebase 초기화
    let firebaseInitialized = false;
    
    try {
        // Firebase 앱 초기화
        firebase.initializeApp(firebaseConfig);
        console.log("🔥 Firebase 앱 초기화 성공");
        console.log("📊 Database URL: https://gwonjidanwords-default-rtdb.asia-southeast1.firebasedatabase.app/");
        
        // Analytics 초기화 (선택사항)
        const analytics = firebase.analytics();
        console.log("📈 Firebase Analytics 초기화 성공");
        
        firebaseInitialized = true;
        
        // 페이지 조회 이벤트 전송
        analytics.logEvent('page_view', {
            page_title: '권지단 어휘대전',
            page_location: window.location.href,
            game_name: '권지단 어휘대전'
        });
        
        // 게임 시작 이벤트 함수
        window.logGameEvent = function(eventName, eventParams = {}) {
            if (firebaseInitialized) {
                try {
                    analytics.logEvent(eventName, eventParams);
                } catch (error) {
                    console.log("📊 이벤트 로깅 실패:", error);
                }
            }
        };
        
    } catch (error) {
        console.error("❌ Firebase 초기화 실패:", error);
        firebaseInitialized = false;
    }

    // Firebase 상태 확인 함수
    window.isFirebaseReady = function() {
        return firebaseInitialized && typeof firebase.database === 'function';
    };

    // Firebase 데이터베이스 참조 함수
    window.getFirebaseRef = function(path) {
        if (window.isFirebaseReady()) {
            return firebase.database().ref(path);
        }
        return null;
    };
    
    // 랭킹 저장 함수
    window.saveRankingToFirebase = async function(rankingData) {
        if (!window.isFirebaseReady()) {
            console.log("❌ Firebase가 준비되지 않아 랭킹 저장 불가");
            return false;
        }
        
        try {
            const rankingsRef = firebase.database().ref('rankings');
            const newRankingRef = rankingsRef.push();
            await newRankingRef.set({
                ...rankingData,
                timestamp: firebase.database.ServerValue.TIMESTAMP
            });
            
            console.log("✅ Firebase 랭킹 저장 성공:", rankingData.nickname, rankingData.score);
            
            // Analytics 이벤트
            if (window.logGameEvent) {
                window.logGameEvent('ranking_saved', {
                    score: rankingData.score,
                    stage: rankingData.stage,
                    nickname_length: rankingData.nickname.length
                });
            }
            
            return true;
        } catch (error) {
            console.error("❌ Firebase 랭킹 저장 실패:", error);
            return false;
        }
    };
    
    // 랭킹 조회 함수
    window.loadRankingsFromFirebase = async function(type = 'score', limit = 50) {
        if (!window.isFirebaseReady()) {
            console.log("❌ Firebase가 준비되지 않아 랭킹 조회 불가");
            return [];
        }
        
        try {
            const rankingsRef = firebase.database().ref('rankings');
            const snapshot = await rankingsRef.orderByChild(type).limitToLast(limit).once('value');
            const data = snapshot.val();
            
            if (data) {
                const rankings = Object.entries(data).map(([key, value]) => ({
                    id: key,
                    ...value
                }));
                
                // 내림차순 정렬
                rankings.sort((a, b) => b[type] - a[type]);
                
                console.log(`✅ Firebase에서 ${rankings.length}개 랭킹 로드 성공`);
                return rankings;
            }
            
            return [];
        } catch (error) {
            console.error("❌ Firebase 랭킹 조회 실패:", error);
            return [];
        }
    };
    
    console.log("✅ Firebase 설정 완료. 상태:", firebaseInitialized ? "활성화" : "비활성화");
    </script>
    
    <!-- 모바일 최적화 및 이벤트 핸들러 -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // 게임 시작 및 오버레이 이벤트는 game.js에서 처리
        // 여기서는 UI 관련 이벤트만 처리
        
        // 닉네임 입력 처리
        const nicknameInput = document.getElementById('nicknameInput');
        const nicknameCount = document.getElementById('nicknameCount');
        
        if (nicknameInput && nicknameCount) {
            // 저장된 닉네임이 있으면 표시
            const savedNickname = localStorage.getItem('kjd_nickname');
            if (savedNickname) {
                nicknameInput.value = savedNickname;
                nicknameCount.textContent = savedNickname.length;
            }
            
            nicknameInput.addEventListener('input', function() {
                let text = this.value.replace(/[^a-zA-Z0-9가-힣ㄱ-ㅎㅏ-ㅣ\s]/g, '');
                if (text.length > 10) text = text.substring(0, 10);
                this.value = text;
                nicknameCount.textContent = text.length;
            });
        }
        
        // 키보드 감지 및 UI 조정
        window.addEventListener('resize', function() {
            if (window.innerHeight < window.outerHeight * 0.7) {
                document.body.classList.add('keyboard-open');
            } else {
                document.body.classList.remove('keyboard-open');
            }
        });
        
        // 페이지 로드 시 닉네임 확인
        setTimeout(() => {
            const savedNickname = localStorage.getItem('kjd_nickname');
            const savedDeviceId = localStorage.getItem('kjd_device_id');
            
            if (!savedNickname || !savedDeviceId) {
                // 닉네임이 없으면 닉네임 화면 표시
                document.querySelector('.start-screen').classList.remove('active');
                document.querySelector('.nickname-screen').classList.add('active');
            }
        }, 500);
    });
    </script>
</body>
</html>