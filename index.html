<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ê¶Œì§€ë‹¨ ì–´íœ˜ëŒ€ì „</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-analytics-compat.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; touch-action: manipulation; }
        html, body { width: 100%; height: 100%; overflow: hidden; font-family: 'Inter', sans-serif; background: #0a0a0f; color: #fff; position: fixed; }
        .game-container { width: 100%; height: 100vh; height: -webkit-fill-available; max-width: 500px; margin: 0 auto; display: flex; flex-direction: column; background: #0a0a0f; overflow: hidden; }
        
        /* ì• ë‹ˆë©”ì´ì…˜ ì •ì˜ */
        @keyframes monsterSpawn {
            0% { transform: scale(0) rotate(-180deg); opacity: 0; }
            70% { transform: scale(1.2) rotate(20deg); opacity: 1; }
            100% { transform: scale(1) rotate(0); opacity: 1; }
        }
        
        @keyframes monsterIdle {
            0%, 100% { transform: translateY(0) scale(1) rotate(0deg); }
            25% { transform: translateY(-5px) scale(1.05) rotate(-2deg); }
            50% { transform: translateY(0) scale(1) rotate(0deg); }
            75% { transform: translateY(5px) scale(0.95) rotate(2deg); }
        }
        
        @keyframes monsterDeath {
            0% { transform: scale(1) rotate(0deg); opacity: 1; }
            30% { transform: scale(1.3) rotate(30deg); opacity: 0.8; }
            100% { transform: scale(0) rotate(90deg); opacity: 0; }
        }
        
        @keyframes playerIdle {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        @keyframes playerHit {
            0% { transform: scale(1); }
            25% { transform: scale(1.2) translateX(10px); }
            50% { transform: scale(0.9) translateX(-20px); }
            75% { transform: scale(1.1) translateX(5px); }
            100% { transform: scale(1); }
        }
        
        @keyframes playerHeal {
            0% { transform: scale(1); }
            25% { transform: scale(1.3); }
            50% { transform: scale(1.1); }
            75% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        
        @keyframes hitEffect {
            0% { transform: scale(1); filter: brightness(1); }
            50% { transform: scale(0.9); filter: brightness(1.5); }
            100% { transform: scale(1); filter: brightness(1); }
        }
    </style>
</head>
<body>
    <div class="game-container">
        
        <div class="game-header">
            <div class="header-left">
                <span class="game-logo">âš”ï¸ ê¶Œì§€ë‹¨</span>
                <div class="stage-display">
                    <span class="stage-label">STAGE</span>
                    <span class="stage-value" id="currentStage">1</span>
                    <span class="stage-slash">/</span>
                    <span class="stage-total">10</span>
                </div>
                <div class="score-display">
                    <span class="score-label">SCORE</span>
                    <span class="score-value" id="currentScore">0</span>
                </div>
            </div>
            
            <div class="header-right">
                <button class="menu-btn" id="pauseBtn">
                    <i class="fas fa-cog"></i>
                </button>
            </div>
        </div>
        
        <div class="battle-area">
            <div class="combatant monster-side">
                <div class="combatant-avatar">
                    <div class="avatar-circle monster-circle">
                        <div class="monster-avatar" id="monsterAvatar">ğŸ‘¹</div>
                    </div>
                    <div class="combatant-info">
                        <div class="combatant-name" id="monsterNameDisplay">ì´ˆê¸‰</div>
                        <div class="combatant-level" id="monsterLevel">Lv.1</div>
                    </div>
                </div>
                <div class="combatant-health monster-health">
                    <div class="health-bar-container">
                        <div class="health-bar-fill monster-bar" id="monsterHpBar"></div>
                    </div>
                    <div class="health-text" id="monsterHpText">100/100</div>
                </div>
            </div>
            
            <div class="battle-center">
                <div class="time-display" id="timeDisplay">10</div>
            </div>
            
            <div class="combatant player-side">
                <div class="combatant-avatar">
                    <div class="combatant-info">
                        <div class="combatant-name">YOU</div>
                        <div class="combatant-level">ğŸ‘¤</div>
                    </div>
                    <div class="avatar-circle player-circle">
                        <div class="player-avatar" id="playerAvatar">ğŸ‘¤</div>
                    </div>
                </div>
                <div class="combatant-health player-health">
                    <div class="health-text" id="playerHpText">100/100</div>
                    <div class="health-bar-container">
                        <div class="health-bar-fill player-bar" id="playerHpBar"></div>
                    </div>
                </div>
            </div>
            
            <div class="center-speech">
                <div class="speech-bubble" id="monsterSpeech">
                    <div class="speech-content">ë„ˆë¥¼ ì´ê¸°ê³  ë§ê² ë‹¤!</div>
                </div>
            </div>
        </div>
        
        <div class="problem-area">
            <div class="hint-line">
                <div class="hint-container">
                    <div class="initial-display" id="initialDisplay">ã„±ã…‡</div>
                </div>
                <button class="icon-btn potion-btn" id="potionBtn">
                    <i class="fas fa-flask"></i>
                    <span class="potion-count" id="potionCount">2</span>
                </button>
            </div>
            
            <div class="meaning-section">
                <div class="meaning-display" id="meaningDisplay">ë³‘ì›ì²´ê°€ ëª¸ì†ì— ë“¤ì–´ì™€ ë²ˆì‹í•˜ëŠ” ê²ƒ</div>
            </div>
        </div>
        
        <div class="input-area">
            <input type="text" 
                   id="wordInput" 
                   class="word-input"
                   maxlength="5"
                   placeholder="í•œê¸€ 2~5ê¸€ì ì…ë ¥"
                   autocapitalize="none"
                   autocorrect="off"
                   spellcheck="false"
                   autocomplete="off"
                   inputmode="text">
            <div class="input-hint">
                <span class="hint-text"></span>
            </div>
        </div>
        
        <div class="overlay start-screen active">
            <div class="overlay-content">
                <div class="welcome-screen">
                    <div class="title-section">
                        <div class="title-icon">âš”ï¸</div>
                        <h1>ê¶Œì§€ë‹¨</h1>
                        <h2>ì–´íœ˜ëŒ€ì „</h2>
                    </div>
                    
                    <div class="welcome-message">
                        <p>ì´ˆì„±ê³¼ ëœ»ì„ ë³´ê³  ë‹¨ì–´ë¥¼ ë§ì¶°<br>ëª¬ìŠ¤í„°ë¥¼ ë¬¼ë¦¬ì¹˜ëŠ” ê³ ë°€ë„ ì–´íœ˜ ëŒ€ê²°!</p>
                    </div>
                    
                    <div class="game-features">
                        <div class="feature"><span>ğŸ¯</span> 2~5ê¸€ì ê³ ê¸‰ì–´íœ˜</div>
                        <div class="feature"><span>âš”ï¸</span> 10ë‹¨ê³„ ëŒ€ê²°</div>
                        <div class="feature"><span>ğŸ”¥</span> ì½¤ë³´ ì‹œìŠ¤í…œ</div>
                        <div class="feature"><span>ğŸ§ª</span> ë¬¼ì•½ íšŒë³µ</div>
                    </div>
                    
                    <button class="start-button" id="startBtn">
                        <i class="fas fa-play"></i> ëŒ€ê²° ì‹œì‘
                    </button>
                    
                    <div class="game-guide">
                        <h3><i class="fas fa-graduation-cap"></i> ê²Œì„ ë°©ë²•</h3>
                        <ol>
                            <li>ì´ˆì„±ê³¼ ëœ»ì„ ë³´ê³  ë‹¨ì–´ ì…ë ¥ (2~5ê¸€ì)</li>
                            <li>ì •ë‹µ â†’ ëª¬ìŠ¤í„° ê³µê²© / ì˜¤ë‹µ â†’ í”Œë ˆì´ì–´ í”¼í•´</li>
                            <li>ì½¤ë³´ ìœ ì§€ ì‹œ ê°•ë ¥í•œ ê³µê²©</li>
                            <li>ë¬¼ì•½ìœ¼ë¡œ ì²´ë ¥ íšŒë³µ ê°€ëŠ¥</li>
                            <li>10ë‹¨ê³„ ëª¬ìŠ¤í„° ë¬¼ë¦¬ì¹˜ë©´ ìŠ¹ë¦¬!</li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="overlay settings-screen">
            <div class="overlay-content">
                <div class="settings-header">
                    <i class="fas fa-cog"></i>
                    <h2>ì„¤ì •</h2>
                </div>
                
                <div class="settings-stats">
                    <div class="setting-stat">
                        <div class="stat-icon">âš”ï¸</div>
                        <div class="stat-info">
                            <div class="stat-label">ìŠ¤í…Œì´ì§€</div>
                            <div class="stat-value" id="settingsStage">Lv.1</div>
                        </div>
                    </div>
                    <div class="setting-stat">
                        <div class="stat-icon">ğŸ§ª</div>
                        <div class="stat-info">
                            <div class="stat-label">ë¬¼ì•½</div>
                            <div class="stat-value" id="settingsPotion">2</div>
                        </div>
                    </div>
                </div>
                
                <div class="settings-actions">
                    <button class="btn primary" id="resumeBtn">
                        <i class="fas fa-play"></i> ê²Œì„ ê³„ì†
                    </button>
                    <button class="btn secondary" id="settingsRankingBtn">
                        <i class="fas fa-trophy"></i> ë­í‚¹ ë³´ê¸°
                    </button>
                    <button class="btn secondary" id="restartBtn">
                        <i class="fas fa-redo"></i> ë‹¤ì‹œ ì‹œì‘
                    </button>
                    <button class="btn secondary" id="quitBtn">
                        <i class="fas fa-home"></i> ì‹œì‘ í™”ë©´
                    </button>
                </div>
            </div>
        </div>
        
        <div class="overlay ranking-screen">
            <div class="overlay-content">
                <div class="ranking-header">
                    <div class="ranking-icon">ğŸ†</div>
                    <h2>ë­í‚¹</h2>
                </div>
                
                <div class="ranking-controls">
                    <button class="ranking-tab active" data-type="score">ìµœê³  ì ìˆ˜</button>
                    <button class="ranking-tab" data-type="stage">ìµœê³  ë‹¨ê³„</button>
                    <button class="ranking-tab" data-type="combo">ìµœê³  ì½¤ë³´</button>
                </div>
                
                <div class="ranking-list" id="rankingList">
                    <div class="loading-rankings">
                        <i class="fas fa-spinner fa-spin"></i> ë­í‚¹ ë¡œë”© ì¤‘...
                    </div>
                </div>
                
                <div class="ranking-actions">
                    <button class="btn secondary" id="closeRankingBtn">
                        <i class="fas fa-arrow-left"></i> ëŒì•„ê°€ê¸°
                    </button>
                </div>
            </div>
        </div>
        
        <div class="overlay result-screen win-screen">
            <div class="overlay-content">
                <div class="result-header">
                    <div class="result-icon">ğŸ†</div>
                    <h2>ìŠ¹ë¦¬!</h2>
                    <p class="result-sub">ëª¨ë“  ëª¬ìŠ¤í„° ë¬¼ë¦¬ì¹¨</p>
                </div>
                
                <div class="result-stats">
                    <div class="result-stat">
                        <div class="stat-icon">â­</div>
                        <div class="stat-info">
                            <div class="stat-label">ì ìˆ˜</div>
                            <div class="stat-value" id="finalScore">0</div>
                        </div>
                    </div>
                    <div class="result-stat">
                        <div class="stat-icon">ğŸ”¥</div>
                        <div class="stat-info">
                            <div class="stat-label">ìµœê³  ì½¤ë³´</div>
                            <div class="stat-value" id="finalCombo">0</div>
                        </div>
                    </div>
                    <div class="result-stat">
                        <div class="stat-icon">ğŸ¯</div>
                        <div class="stat-info">
                            <div class="stat-label">ì •í™•ë„</div>
                            <div class="stat-value" id="finalAccuracy">100%</div>
                        </div>
                    </div>
                    <div class="result-stat">
                        <div class="stat-icon">â±ï¸</div>
                        <div class="stat-info">
                            <div class="stat-label">ì‹œê°„</div>
                            <div class="stat-value" id="finalTime">0ì´ˆ</div>
                        </div>
                    </div>
                </div>
                
                <div class="result-actions">
                    <button class="btn primary" id="playAgainBtn">
                        <i class="fas fa-redo"></i> ë‹¤ì‹œí•˜ê¸°
                    </button>
                    <button class="btn secondary" id="winRankingBtn">
                        <i class="fas fa-trophy"></i> ë­í‚¹ ë³´ê¸°
                    </button>
                </div>
            </div>
        </div>
        
        <div class="overlay result-screen lose-screen">
            <div class="overlay-content">
                <div class="result-header">
                    <div class="result-icon">ğŸ’€</div>
                    <h2>íŒ¨ë°°</h2>
                    <p class="result-sub">ì²´ë ¥ ì†Œì§„</p>
                </div>
                
                <div class="result-stats">
                    <div class="result-stat">
                        <div class="stat-icon">â­</div>
                        <div class="stat-info">
                            <div class="stat-label">ì ìˆ˜</div>
                            <div class="stat-value" id="loseScore">0</div>
                        </div>
                    </div>
                    <div class="result-stat">
                        <div class="stat-icon">ğŸ”¥</div>
                        <div class="stat-info">
                            <div class="stat-label">ìµœê³  ì½¤ë³´</div>
                            <div class="stat-value" id="loseCombo">0</div>
                        </div>
                    </div>
                    <div class="result-stat">
                        <div class="stat-icon">ğŸ¯</div>
                        <div class="stat-info">
                            <div class="stat-label">í´ë¦¬ì–´ ë‹¨ê³„</div>
                            <div class="stat-value" id="loseStage">1/10</div>
                        </div>
                    </div>
                </div>
                
                <div class="result-actions">
                    <button class="btn primary" id="restartFromLoseBtn">
                        <i class="fas fa-redo"></i> ë‹¤ì‹œ ë„ì „
                    </button>
                    <button class="btn secondary" id="loseRankingBtn">
                        <i class="fas fa-trophy"></i> ë­í‚¹ ë³´ê¸°
                    </button>
                </div>
            </div>
        </div>
        
        <div class="effects-layer"></div>
        <div class="damage-layer"></div>
        
    </div>
    
    <audio id="soundCorrect" preload="auto">
        <source src="sounds/correct.mp3" type="audio/mpeg">
    </audio>
    <audio id="soundWrong" preload="auto">
        <source src="sounds/wrong.mp3" type="audio/mpeg">
    </audio>
    <audio id="soundDamage" preload="auto">
        <source src="sounds/damage.mp3" type="audio/mpeg">
    </audio>
    <audio id="soundHit" preload="auto">
        <source src="sounds/hit.mp3" type="audio/mpeg">
    </audio>
    <audio id="soundCombo" preload="auto">
        <source src="sounds/combo.mp3" type="audio/mpeg">
    </audio>
    <audio id="soundVictory" preload="auto">
        <source src="sounds/victory.mp3" type="audio/mpeg">
    </audio>
    <audio id="soundPotion" preload="auto">
        <source src="sounds/potion.mp3" type="audio/mpeg">
    </audio>
    
    <script src="game.js"></script>
    
    <script>
    const firebaseConfig = {
        apiKey: "AIzaSyApBB-QuQBOImgysqbfeffYBowEeERYRS4",
        authDomain: "gwonjidanwords.firebaseapp.com",
        databaseURL: "https://gwonjidanwords-default-rtdb.asia-southeast1.firebasedatabase.app/",
        projectId: "gwonjidanwords",
        storageBucket: "gwonjidanwords.firebasestorage.app",
        messagingSenderId: "602593593346",
        appId: "1:602593593346:web:17eeaba9ac91100942ff1b",
        measurementId: "G-GRW0CC74MP"
    };

    let firebaseInitialized = false;
    
    try {
        firebase.initializeApp(firebaseConfig);
        console.log("ğŸ”¥ Firebase ì´ˆê¸°í™” ì„±ê³µ");
        firebaseInitialized = true;
    } catch (error) {
        console.error("âŒ Firebase ì´ˆê¸°í™” ì‹¤íŒ¨:", error);
    }

    window.isFirebaseReady = function() {
        return firebaseInitialized && typeof firebase.database === 'function';
    };
    
    window.saveRankingToFirebase = async function(rankingData) {
        if (!window.isFirebaseReady()) return false;
        
        try {
            const rankingsRef = firebase.database().ref('rankings');
            const newRankingRef = rankingsRef.push();
            await newRankingRef.set({
                ...rankingData,
                timestamp: firebase.database.ServerValue.TIMESTAMP
            });
            return true;
        } catch (error) {
            console.error("âŒ Firebase ë­í‚¹ ì €ì¥ ì‹¤íŒ¨:", error);
            return false;
        }
    };
    
    window.loadRankingsFromFirebase = async function(type = 'score', limit = 50) {
        if (!window.isFirebaseReady()) return [];
        
        try {
            const rankingsRef = firebase.database().ref('rankings');
            const snapshot = await rankingsRef.orderByChild(type).limitToLast(limit).once('value');
            const data = snapshot.val();
            
            if (data) {
                return Object.entries(data).map(([key, value]) => ({
                    id: key,
                    ...value
                })).sort((a, b) => b[type] - a[type]);
            }
            return [];
        } catch (error) {
            console.error("âŒ Firebase ë­í‚¹ ì¡°íšŒ ì‹¤íŒ¨:", error);
            return [];
        }
    };
    </script>
</body>
</html>