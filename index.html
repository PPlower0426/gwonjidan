<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>권지단 어휘대전</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-analytics-compat.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; touch-action: manipulation; }
        html, body { width: 100%; height: 100%; overflow: hidden; font-family: 'Inter', sans-serif; background: #0a0a0f; color: #fff; position: fixed; }
        .game-container { width: 100%; height: 100vh; height: -webkit-fill-available; max-width: 500px; margin: 0 auto; display: flex; flex-direction: column; background: #0a0a0f; overflow: hidden; }
    </style>
</head>
<body>
    <!-- 게임 컨테이너 -->
    <div class="game-container">
        
        <!-- 간소화된 헤더 -->
        <div class="game-header">
            <div class="header-left">
                <span class="game-logo">⚔️ 권지단</span>
                <div class="stage-display">
                    <span class="stage-label">STAGE</span>
                    <span class="stage-value" id="currentStage">1</span>
                    <span class="stage-slash">/</span>
                    <span class="stage-total">10</span>
                </div>
            </div>
            
            <div class="header-right">
                <button class="menu-btn" id="pauseBtn">
                    <i class="fas fa-cog"></i>
                </button>
            </div>
        </div>
        
        <!-- 대결 영역 (심플하게) -->
        <div class="battle-area">
            <!-- 몬스터 측 -->
            <div class="combatant monster-side">
                <div class="combatant-avatar">
                    <div class="avatar-circle monster-circle">
                        <div class="monster-avatar" id="monsterAvatar">👹</div>
                    </div>
                    <div class="combatant-info">
                        <div class="combatant-name" id="monsterNameDisplay">초급</div>
                        <div class="combatant-level" id="monsterLevel">Lv.1</div>
                    </div>
                </div>
                <!-- 몬스터 체력 -->
                <div class="combatant-health monster-health">
                    <div class="health-bar-container">
                        <div class="health-bar-fill monster-bar" id="monsterHpBar"></div>
                    </div>
                    <div class="health-text" id="monsterHpText">100/100</div>
                </div>
            </div>
            
            <!-- 중앙 시간 -->
            <div class="battle-center">
                <div class="time-display" id="timeDisplay">10</div>
            </div>
            
            <!-- 플레이어 측 -->
            <div class="combatant player-side">
                <div class="combatant-avatar">
                    <div class="combatant-info">
                        <div class="combatant-name">YOU</div>
                        <div class="combatant-level">👤</div>
                    </div>
                    <div class="avatar-circle player-circle">
                        <div class="player-avatar" id="playerAvatar">👤</div>
                    </div>
                </div>
                <!-- 플레이어 체력 -->
                <div class="combatant-health player-health">
                    <div class="health-text" id="playerHpText">100/100</div>
                    <div class="health-bar-container">
                        <div class="health-bar-fill player-bar" id="playerHpBar"></div>
                    </div>
                </div>
            </div>
            
            <!-- 중앙 대사 -->
            <div class="center-speech">
                <div class="speech-bubble" id="monsterSpeech">
                    <div class="speech-content">너를 이기고 말겠다!</div>
                </div>
            </div>
        </div>
        
        <!-- 문제 영역 -->
        <div class="problem-area">
            <!-- 초성 힌트 줄 -->
            <div class="hint-line">
                <div class="hint-container">
                    <div class="hint-label">초성</div>
                    <div class="initial-display" id="initialDisplay">ㄱㅇ</div>
                </div>
                <button class="icon-btn potion-btn" id="potionBtn">
                    <i class="fas fa-flask"></i>
                    <span class="potion-count" id="potionCount">3</span>
                </button>
            </div>
            
            <!-- 뜻 설명 -->
            <div class="meaning-section">
                <div class="meaning-display" id="meaningDisplay">병원체가 몸속에 들어와 번식하는 것</div>
            </div>
        </div>
        
        <!-- 입력 영역 (키보드만) -->
        <div class="input-area">
            <input type="text" 
                   id="wordInput" 
                   class="word-input"
                   maxlength="5"
                   placeholder="단어 입력"
                   autocapitalize="none"
                   autocorrect="off"
                   spellcheck="false"
                   autocomplete="off"
                   inputmode="text">
        </div>
        
        <!-- 오버레이 화면들 -->
        
        <!-- 시작 화면 -->
        <div class="overlay start-screen active">
            <div class="overlay-content">
                <div class="welcome-screen">
                    <div class="title-section">
                        <div class="title-icon">⚔️</div>
                        <h1>권지단</h1>
                        <h2>어휘대전</h2>
                    </div>
                    
                    <div class="welcome-message">
                        <p>초성과 뜻을 보고 단어를 맞춰<br>몬스터를 물리치는 고밀도 어휘 대결!</p>
                    </div>
                    
                    <div class="game-features">
                        <div class="feature"><span>🎯</span> 2~5글자 고급어휘</div>
                        <div class="feature"><span>⚔️</span> 10단계 대결</div>
                        <div class="feature"><span>🔥</span> 콤보 시스템</div>
                        <div class="feature"><span>🧪</span> 물약 회복</div>
                    </div>
                    
                    <button class="start-button" id="startBtn">
                        <i class="fas fa-play"></i> 대결 시작
                    </button>
                    
                    <div class="game-guide">
                        <h3><i class="fas fa-graduation-cap"></i> 게임 방법</h3>
                        <ol>
                            <li>초성과 뜻을 보고 단어 입력 (2~5글자)</li>
                            <li>정답 → 몬스터 공격 / 오답 → 플레이어 피해</li>
                            <li>콤보 유지 시 강력한 공격</li>
                            <li>물약으로 체력 회복 가능</li>
                            <li>10단계 몬스터 물리치면 승리!</li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 설정 화면 -->
        <div class="overlay settings-screen">
            <div class="overlay-content">
                <div class="settings-header">
                    <i class="fas fa-cog"></i>
                    <h2>설정</h2>
                </div>
                
                <div class="settings-stats">
                    <div class="setting-stat">
                        <div class="stat-icon">⚔️</div>
                        <div class="stat-info">
                            <div class="stat-label">스테이지</div>
                            <div class="stat-value" id="settingsStage">Lv.1</div>
                        </div>
                    </div>
                    <div class="setting-stat">
                        <div class="stat-icon">🧪</div>
                        <div class="stat-info">
                            <div class="stat-label">물약</div>
                            <div class="stat-value" id="settingsPotion">3</div>
                        </div>
                    </div>
                </div>
                
                <div class="settings-actions">
                    <button class="btn primary" id="resumeBtn">
                        <i class="fas fa-play"></i> 게임 계속
                    </button>
                    <button class="btn secondary" id="settingsRankingBtn">
                        <i class="fas fa-trophy"></i> 랭킹 보기
                    </button>
                    <button class="btn secondary" id="restartBtn">
                        <i class="fas fa-redo"></i> 다시 시작
                    </button>
                    <button class="btn secondary" id="quitBtn">
                        <i class="fas fa-home"></i> 시작 화면
                    </button>
                </div>
            </div>
        </div>
        
        <!-- 랭킹 화면 -->
        <div class="overlay ranking-screen">
            <div class="overlay-content">
                <div class="ranking-header">
                    <div class="ranking-icon">🏆</div>
                    <h2>랭킹</h2>
                </div>
                
                <div class="ranking-controls">
                    <button class="ranking-tab active" data-type="score">최고 점수</button>
                    <button class="ranking-tab" data-type="stage">최고 단계</button>
                    <button class="ranking-tab" data-type="combo">최고 콤보</button>
                </div>
                
                <div class="ranking-list" id="rankingList">
                    <div class="loading-rankings">
                        <i class="fas fa-spinner fa-spin"></i> 랭킹 로딩 중...
                    </div>
                </div>
                
                <div class="ranking-actions">
                    <button class="btn secondary" id="closeRankingBtn">
                        <i class="fas fa-arrow-left"></i> 돌아가기
                    </button>
                </div>
            </div>
        </div>
        
        <!-- 승리 화면 -->
        <div class="overlay result-screen win-screen">
            <div class="overlay-content">
                <div class="result-header">
                    <div class="result-icon">🏆</div>
                    <h2>승리!</h2>
                    <p class="result-sub">모든 몬스터 물리침</p>
                </div>
                
                <div class="result-stats">
                    <div class="result-stat">
                        <div class="stat-icon">⭐</div>
                        <div class="stat-info">
                            <div class="stat-label">점수</div>
                            <div class="stat-value" id="finalScore">0</div>
                        </div>
                    </div>
                    <div class="result-stat">
                        <div class="stat-icon">🔥</div>
                        <div class="stat-info">
                            <div class="stat-label">최고 콤보</div>
                            <div class="stat-value" id="finalCombo">0</div>
                        </div>
                    </div>
                    <div class="result-stat">
                        <div class="stat-icon">🎯</div>
                        <div class="stat-info">
                            <div class="stat-label">정확도</div>
                            <div class="stat-value" id="finalAccuracy">100%</div>
                        </div>
                    </div>
                    <div class="result-stat">
                        <div class="stat-icon">⏱️</div>
                        <div class="stat-info">
                            <div class="stat-label">시간</div>
                            <div class="stat-value" id="finalTime">0초</div>
                        </div>
                    </div>
                </div>
                
                <div class="result-actions">
                    <button class="btn primary" id="playAgainBtn">
                        <i class="fas fa-redo"></i> 다시하기
                    </button>
                    <button class="btn secondary" id="winRankingBtn">
                        <i class="fas fa-trophy"></i> 랭킹 보기
                    </button>
                </div>
            </div>
        </div>
        
        <!-- 패배 화면 -->
        <div class="overlay result-screen lose-screen">
            <div class="overlay-content">
                <div class="result-header">
                    <div class="result-icon">💀</div>
                    <h2>패배</h2>
                    <p class="result-sub">체력 소진</p>
                </div>
                
                <div class="result-stats">
                    <div class="result-stat">
                        <div class="stat-icon">⭐</div>
                        <div class="stat-info">
                            <div class="stat-label">점수</div>
                            <div class="stat-value" id="loseScore">0</div>
                        </div>
                    </div>
                    <div class="result-stat">
                        <div class="stat-icon">🔥</div>
                        <div class="stat-info">
                            <div class="stat-label">최고 콤보</div>
                            <div class="stat-value" id="loseCombo">0</div>
                        </div>
                    </div>
                    <div class="result-stat">
                        <div class="stat-icon">🎯</div>
                        <div class="stat-info">
                            <div class="stat-label">클리어 단계</div>
                            <div class="stat-value" id="loseStage">1/10</div>
                        </div>
                    </div>
                </div>
                
                <div class="result-actions">
                    <button class="btn primary" id="restartFromLoseBtn">
                        <i class="fas fa-redo"></i> 다시 도전
                    </button>
                    <button class="btn secondary" id="loseRankingBtn">
                        <i class="fas fa-trophy"></i> 랭킹 보기
                    </button>
                </div>
            </div>
        </div>
        
        <!-- 이펙트 레이어 -->
        <div class="effects-layer"></div>
        <div class="damage-layer"></div>
        
    </div>
    
    <!-- 사운드 요소들 -->
    <audio id="soundCorrect" preload="auto">
        <source src="sounds/correct.mp3" type="audio/mpeg">
    </audio>
    <audio id="soundWrong" preload="auto">
        <source src="sounds/wrong.mp3" type="audio/mpeg">
    </audio>
    <audio id="soundDamage" preload="auto">
        <source src="sounds/damage.mp3" type="audio/mpeg">
    </audio>
    <audio id="soundHit" preload="auto">
        <source src="sounds/hit.mp3" type="audio/mpeg">
    </audio>
    <audio id="soundCombo" preload="auto">
        <source src="sounds/combo.mp3" type="audio/mpeg">
    </audio>
    <audio id="soundVictory" preload="auto">
        <source src="sounds/victory.mp3" type="audio/mpeg">
    </audio>
    <audio id="soundPotion" preload="auto">
        <source src="sounds/potion.mp3" type="audio/mpeg">
    </audio>
    
    <!-- 게임 로직 -->
    <script src="game.js"></script>
    
    <!-- Firebase 설정 및 초기화 -->
    <script>
    // Firebase 구성 정보
    const firebaseConfig = {
        apiKey: "AIzaSyApBB-QuQBOImgysqbfeffYBowEeERYRS4",
        authDomain: "gwonjidanwords.firebaseapp.com",
        databaseURL: "https://gwonjidanwords-default-rtdb.asia-southeast1.firebasedatabase.app/",
        projectId: "gwonjidanwords",
        storageBucket: "gwonjidanwords.firebasestorage.app",
        messagingSenderId: "602593593346",
        appId: "1:602593593346:web:17eeaba9ac91100942ff1b",
        measurementId: "G-GRW0CC74MP"
    };

    // Firebase 초기화
    let firebaseInitialized = false;
    
    try {
        firebase.initializeApp(firebaseConfig);
        console.log("🔥 Firebase 초기화 성공");
        firebaseInitialized = true;
    } catch (error) {
        console.error("❌ Firebase 초기화 실패:", error);
    }

    // Firebase 상태 확인 함수
    window.isFirebaseReady = function() {
        return firebaseInitialized && typeof firebase.database === 'function';
    };
    
    // 랭킹 저장 함수
    window.saveRankingToFirebase = async function(rankingData) {
        if (!window.isFirebaseReady()) return false;
        
        try {
            const rankingsRef = firebase.database().ref('rankings');
            const newRankingRef = rankingsRef.push();
            await newRankingRef.set({
                ...rankingData,
                timestamp: firebase.database.ServerValue.TIMESTAMP
            });
            return true;
        } catch (error) {
            console.error("❌ Firebase 랭킹 저장 실패:", error);
            return false;
        }
    };
    
    // 랭킹 조회 함수
    window.loadRankingsFromFirebase = async function(type = 'score', limit = 50) {
        if (!window.isFirebaseReady()) return [];
        
        try {
            const rankingsRef = firebase.database().ref('rankings');
            const snapshot = await rankingsRef.orderByChild(type).limitToLast(limit).once('value');
            const data = snapshot.val();
            
            if (data) {
                return Object.entries(data).map(([key, value]) => ({
                    id: key,
                    ...value
                })).sort((a, b) => b[type] - a[type]);
            }
            return [];
        } catch (error) {
            console.error("❌ Firebase 랭킹 조회 실패:", error);
            return [];
        }
    };
    </script>
</body>
</html>