<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ê¶Œì§€ë‹¨ ì–´íœ˜ëŒ€ì „</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-analytics-compat.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; touch-action: manipulation; }
        html, body { width: 100%; height: 100%; overflow: hidden; font-family: 'Inter', sans-serif; background: #0a0a0f; color: #fff; position: fixed; }
        .game-container { width: 100%; height: 100vh; height: -webkit-fill-available; max-width: 500px; margin: 0 auto; display: flex; flex-direction: column; background: #0a0a0f; overflow: hidden; }
    </style>
</head>
<body>
    <!-- ê²Œì„ ì»¨í…Œì´ë„ˆ -->
    <div class="game-container">
        
        <!-- ìµœì†Œí™” í—¤ë” -->
        <div class="game-header">
            <div class="header-main">
                <span class="game-logo">âš”ï¸ ê¶Œì§€ë‹¨</span>
                <div class="header-info">
                    <span class="stage-info">ìŠ¤í…Œì´ì§€ <strong id="currentStage">1</strong>/10</span>
                    <span class="score-info">â­ <strong id="currentScore">0</strong></span>
                </div>
            </div>
            <div class="header-right">
                <button class="icon-btn ranking-header-btn" id="headerRankingBtn" title="ë­í‚¹">
                    <i class="fas fa-trophy"></i>
                </button>
                <button class="menu-btn" id="pauseBtn"><i class="fas fa-bars"></i></button>
            </div>
        </div>
        
        <!-- ëŒ€ê²° ì˜ì—­ (ì´ˆê³ ë°€ë„) -->
        <div class="battle-area">
            <!-- ëª¬ìŠ¤í„° ì¸¡ -->
            <div class="monster-container">
                <div class="combatant-body">
                    <div class="avatar-circle monster-circle">
                        <div class="monster-avatar" id="monsterAvatar">ğŸ‘¹</div>
                        <!-- ë§í’ì„  í‘œì‹œê¸° (ëª¬ìŠ¤í„° ë§í•  ë•Œ ë³´ì„) -->
                        <div class="speech-indicator" id="monsterSpeechIndicator">
                            <div class="indicator-dot"></div>
                            <div class="indicator-dot"></div>
                            <div class="indicator-dot"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ëŒ€ê²° ì¤‘ì•™ì„  -->
            <div class="battle-center">
                <div class="battle-line"></div>
                <div class="quick-stats">
                    <div class="mini-stat"><span class="stat-icon">ğŸ”¥</span><span class="stat-val" id="comboStat">0</span></div>
                    <div class="mini-stat"><span class="stat-icon">â±ï¸</span><span class="stat-val" id="timeStat">10</span></div>
                    <div class="mini-stat"><span class="stat-icon">ğŸ¯</span><span class="stat-val" id="accuracyStat">100%</span></div>
                    <div class="mini-stat"><span class="stat-icon">âš¡</span><span class="stat-val" id="recordStat">0</span></div>
                </div>
            </div>
            
            <!-- í”Œë ˆì´ì–´ ì¸¡ -->
            <div class="player-container">
                <div class="combatant-body">
                    <div class="avatar-circle player-circle">
                        <div class="player-avatar" id="playerAvatar">ğŸ‘¤</div>
                    </div>
                </div>
            </div>
            
            <!-- ì¤‘ì•™ ëŒ€ì‚¬ ì˜ì—­ -->
            <div class="center-speech">
                <div class="speech-bubble" id="monsterSpeech">
                    <div class="speech-content">ë„ˆë¥¼ ì´ê¸°ê³  ë§ê² ë‹¤!</div>
                    <div class="speech-arrow"></div>
                </div>
            </div>
            
            <!-- ì´ë¦„ ë°” -->
            <div class="name-bar">
                <span class="name monster-name" id="monsterNameDisplay">ì´ˆê¸‰ ëª¬ìŠ¤í„°</span>
                <span class="vs">âš”ï¸</span>
                <span class="name player-name">YOU</span>
            </div>
        </div>
        
        <!-- ì²´ë ¥ ë°” ì˜ì—­ (ë¶„ë¦¬ë¨) -->
        <div class="health-area">
            <!-- ëª¬ìŠ¤í„° ì²´ë ¥ -->
            <div class="health-container monster-health">
                <div class="health-header">
                    <span class="health-level" id="monsterLevel">Lv.1</span>
                    <span class="health-text" id="monsterHpText">100/100</span>
                </div>
                <div class="health-bar-container">
                    <div class="health-bar-background"></div>
                    <div class="health-bar-fill monster-bar" id="monsterHpBar" style="width: 100%"></div>
                </div>
            </div>
            
            <!-- í”Œë ˆì´ì–´ ì²´ë ¥ -->
            <div class="health-container player-health">
                <div class="health-header">
                    <span class="health-text" id="playerHpText">100/100</span>
                    <span class="health-level">ğŸ‘¤</span>
                </div>
                <div class="health-bar-container">
                    <div class="health-bar-background"></div>
                    <div class="health-bar-fill player-bar" id="playerHpBar" style="width: 100%"></div>
                </div>
            </div>
        </div>
        
        <!-- ì–‡ì€ ë¶„ë¦¬ì„  -->
        <div class="separator-line"></div>
        
        <!-- ë¬¸ì œ ì¹´ë“œ (ì´ˆê³ ë°€ë„) -->
        <div class="problem-card">
            <div class="card-top">
                <div class="time-display">
                    <span class="time-icon">â±ï¸</span>
                    <span class="time-text" id="timeText">10ì´ˆ</span>
                </div>
                <div class="card-title">ì–´íœ˜ ë¬¸ì œ</div>
            </div>
            
            <div class="card-content">
                <!-- ì´ˆì„± í‘œì‹œ -->
                <div class="hint-section">
                    <div class="initial-display" id="initialDisplay">ã„±ã…‡</div>
                </div>
                
                <!-- ëœ» í‘œì‹œ -->
                <div class="meaning-section">
                    <div class="meaning-display" id="meaningDisplay">ë³‘ì›ì²´ê°€ ëª¸ì†ì— ë“¤ì–´ì™€ ë²ˆì‹í•˜ëŠ” ê²ƒ</div>
                </div>
            </div>
        </div>
        
        <!-- ì…ë ¥ ì¸í„°í˜ì´ìŠ¤ (ì´ˆê³ ë°€ë„) -->
        <div class="input-area">
            <!-- ì…ë ¥ ì•¡ì…˜ -->
            <div class="input-actions">
                <button class="icon-btn potion-btn" id="potionBtn">
                    <i class="fas fa-flask"></i>
                    <span class="potion-count" id="potionCount">3</span>
                </button>
                
                <div class="input-field">
                    <input type="text" 
                           id="wordInput" 
                           class="word-input"
                           maxlength="2"
                           placeholder="ë‘ê¸€ì ì…ë ¥"
                           autocapitalize="none"
                           autocorrect="off"
                           spellcheck="false">
                </div>
                
                <div class="action-buttons">
                    <button class="icon-btn clear-btn" id="clearBtn">
                        <i class="fas fa-times"></i>
                    </button>
                    <button class="icon-btn submit-btn" id="submitBtn">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
            
            <!-- ì…ë ¥ ì•ˆë‚´ -->
            <div class="input-guide">
                <i class="fas fa-info-circle"></i> í•œêµ­ì–´ í‚¤ë³´ë“œ ì‚¬ìš© â€¢ 2ê¸€ì ì…ë ¥ í›„ ì œì¶œ
            </div>
        </div>
        
        <!-- ì˜¤ë²„ë ˆì´ í™”ë©´ë“¤ -->
        
        <!-- ì¼ì‹œì •ì§€ í™”ë©´ -->
        <div class="overlay pause-screen">
            <div class="overlay-content">
                <div class="pause-header">
                    <i class="fas fa-pause"></i>
                    <h2>ëŒ€ê²° ì¼ì‹œì •ì§€</h2>
                </div>
                
                <div class="pause-stats">
                    <div class="pause-stat">
                        <div class="stat-icon">âš”ï¸</div>
                        <div class="stat-info">
                            <div class="stat-label">ìŠ¤í…Œì´ì§€</div>
                            <div class="stat-value" id="pauseStage">Lv.1</div>
                        </div>
                    </div>
                    <div class="pause-stat">
                        <div class="stat-icon">â­</div>
                        <div class="stat-info">
                            <div class="stat-label">ì ìˆ˜</div>
                            <div class="stat-value" id="pauseScore">0</div>
                        </div>
                    </div>
                    <div class="pause-stat">
                        <div class="stat-icon">ğŸ”¥</div>
                        <div class="stat-info">
                            <div class="stat-label">ì½¤ë³´</div>
                            <div class="stat-value" id="pauseCombo">0</div>
                        </div>
                    </div>
                    <div class="pause-stat">
                        <div class="stat-icon">ğŸ§ª</div>
                        <div class="stat-info">
                            <div class="stat-label">ë¬¼ì•½</div>
                            <div class="stat-value" id="pausePotion">3</div>
                        </div>
                    </div>
                </div>
                
                <div class="pause-actions">
                    <button class="btn primary" id="resumeBtn">
                        <i class="fas fa-play"></i> ê³„ì†í•˜ê¸°
                    </button>
                    <button class="btn secondary" id="restartBtn">
                        <i class="fas fa-redo"></i> ë‹¤ì‹œí•˜ê¸°
                    </button>
                </div>
            </div>
        </div>
        
        <!-- ë‹‰ë„¤ì„ ì„¤ì • í™”ë©´ -->
        <div class="overlay nickname-screen">
            <div class="overlay-content">
                <div class="nickname-header">
                    <div class="nickname-icon">ğŸ‘¤</div>
                    <h2>ë‹‰ë„¤ì„ ì„¤ì •</h2>
                    <p class="nickname-sub">ë­í‚¹ì— í‘œì‹œë  ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”</p>
                </div>
                
                <div class="nickname-input-section">
                    <input type="text" 
                           id="nicknameInput" 
                           class="nickname-input"
                           maxlength="10"
                           placeholder="ìµœëŒ€ 10ì"
                           autocapitalize="none"
                           autocorrect="off">
                    <div class="nickname-counter">
                        <span id="nicknameCount">0</span>/10
                    </div>
                </div>
                
                <div class="nickname-notice">
                    <i class="fas fa-info-circle"></i> ë™ì¼ ê¸°ê¸°ì—ì„œëŠ” í•œ ë²ˆë§Œ ì…ë ¥í•©ë‹ˆë‹¤
                </div>
                
                <button class="btn primary" id="saveNicknameBtn">
                    <i class="fas fa-save"></i> ì €ì¥í•˜ê³  ê³„ì†í•˜ê¸°
                </button>
                
                <button class="btn secondary" id="skipNicknameBtn">
                    <i class="fas fa-forward"></i> ê±´ë„ˆë›°ê¸°
                </button>
            </div>
        </div>
        
        <!-- ë­í‚¹ í™”ë©´ -->
        <div class="overlay ranking-screen">
            <div class="overlay-content">
                <div class="ranking-header">
                    <div class="ranking-icon">ğŸ†</div>
                    <h2>ë­í‚¹</h2>
                    <p class="ranking-sub">ì „ì²´ ìƒìœ„ 10ëª…</p>
                </div>
                
                <div class="ranking-controls">
                    <button class="ranking-tab active" data-type="score">ìµœê³  ì ìˆ˜</button>
                    <button class="ranking-tab" data-type="stage">ìµœê³  ë‹¨ê³„</button>
                    <button class="ranking-tab" data-type="combo">ìµœê³  ì½¤ë³´</button>
                </div>
                
                <div class="ranking-list" id="rankingList">
                    <div class="loading-rankings">
                        <i class="fas fa-spinner fa-spin"></i> ë­í‚¹ ë¡œë”© ì¤‘...
                    </div>
                </div>
                
                <div class="my-ranking" id="myRanking">
                    <div class="my-ranking-header">ë‚´ ë­í‚¹</div>
                    <div class="my-ranking-info">
                        <div class="my-rank-details">
                            <div class="my-rank-name">ê²Œì„ì„ í”Œë ˆì´í•˜ë©´ ë­í‚¹ì— ë“±ë¡ë©ë‹ˆë‹¤</div>
                            <div class="my-rank-score">ì•„ì§ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤</div>
                        </div>
                    </div>
                </div>
                
                <div class="ranking-actions">
                    <button class="btn secondary" id="refreshRankingBtn">
                        <i class="fas fa-sync"></i> ìƒˆë¡œê³ ì¹¨
                    </button>
                    <button class="btn primary" id="closeRankingBtn">
                        <i class="fas fa-times"></i> ë‹«ê¸°
                    </button>
                </div>
            </div>
        </div>
        
        <!-- ì‹œì‘ í™”ë©´ -->
        <div class="overlay start-screen">
            <div class="overlay-content">
                <div class="welcome-screen">
                    <div class="title-section">
                        <div class="title-icon">âš”ï¸</div>
                        <h1>ê¶Œì§€ë‹¨</h1>
                        <h2>ì–´íœ˜ëŒ€ì „</h2>
                    </div>
                    
                    <div class="welcome-message">
                        <p>ì´ˆì„±ê³¼ ëœ»ì„ ë³´ê³  ë‹¨ì–´ë¥¼ ë§ì¶°<br>ëª¬ìŠ¤í„°ë¥¼ ë¬¼ë¦¬ì¹˜ëŠ” ê³ ë°€ë„ ì–´íœ˜ ëŒ€ê²°!</p>
                    </div>
                    
                    <div class="game-features">
                        <div class="feature"><span>ğŸ¯</span> 2ê¸€ì ê³ ê¸‰ì–´íœ˜</div>
                        <div class="feature"><span>âš”ï¸</span> 10ë‹¨ê³„ ëŒ€ê²°</div>
                        <div class="feature"><span>ğŸ”¥</span> ì½¤ë³´ ì‹œìŠ¤í…œ</div>
                        <div class="feature"><span>ğŸ§ª</span> ë¬¼ì•½ íšŒë³µ</div>
                        <div class="feature"><span>ğŸ†</span> ì‹¤ì‹œê°„ ë­í‚¹</div>
                        <div class="feature"><span>ğŸ‘¤</span> ë‹‰ë„¤ì„ ì„¤ì •</div>
                    </div>
                    
                    <button class="start-button" id="startBtn">
                        <i class="fas fa-play"></i> ëŒ€ê²° ì‹œì‘
                    </button>
                    
                    <button class="btn secondary ranking-button" id="rankingBtn" style="margin-bottom: 12px;">
                        <i class="fas fa-trophy"></i> ë­í‚¹ ë³´ê¸°
                    </button>
                    
                    <div class="game-guide">
                        <h3><i class="fas fa-graduation-cap"></i> ê²Œì„ ë°©ë²•</h3>
                        <ol>
                            <li>ì´ˆì„±ê³¼ ëœ»ì„ ë³´ê³  2ê¸€ì ë‹¨ì–´ ì…ë ¥</li>
                            <li>ì •ë‹µ â†’ ëª¬ìŠ¤í„° ê³µê²© / ì˜¤ë‹µ â†’ í”Œë ˆì´ì–´ í”¼í•´</li>
                            <li>ì½¤ë³´ ìœ ì§€ ì‹œ ê°•ë ¥í•œ ê³µê²©</li>
                            <li>ë¬¼ì•½ìœ¼ë¡œ ì²´ë ¥ íšŒë³µ ê°€ëŠ¥</li>
                            <li>10ë‹¨ê³„ ëª¬ìŠ¤í„° ë¬¼ë¦¬ì¹˜ë©´ ìŠ¹ë¦¬!</li>
                            <li>ë‹‰ë„¤ì„ ì„¤ì • í›„ ë­í‚¹ì— ê¸°ë¡ ë“±ë¡</li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ìŠ¹ë¦¬ í™”ë©´ -->
        <div class="overlay result-screen win-screen">
            <div class="overlay-content">
                <div class="result-header">
                    <div class="result-icon">ğŸ†</div>
                    <h2>ëŒ€ê²° ìŠ¹ë¦¬!</h2>
                    <p class="result-sub">ëª¨ë“  ëª¬ìŠ¤í„° ë¬¼ë¦¬ì¹¨</p>
                </div>
                
                <div class="result-stats">
                    <div class="result-stat">
                        <div class="stat-icon">â­</div>
                        <div class="stat-info">
                            <div class="stat-label">ìµœì¢… ì ìˆ˜</div>
                            <div class="stat-value" id="finalScore">0</div>
                        </div>
                    </div>
                    <div class="result-stat">
                        <div class="stat-icon">ğŸ”¥</div>
                        <div class="stat-info">
                            <div class="stat-label">ìµœê³  ì½¤ë³´</div>
                            <div class="stat-value" id="finalCombo">0</div>
                        </div>
                    </div>
                    <div class="result-stat">
                        <div class="stat-icon">ğŸ¯</div>
                        <div class="stat-info">
                            <div class="stat-label">ì •í™•ë„</div>
                            <div class="stat-value" id="finalAccuracy">100%</div>
                        </div>
                    </div>
                    <div class="result-stat">
                        <div class="stat-icon">â±ï¸</div>
                        <div class="stat-info">
                            <div class="stat-label">í´ë¦¬ì–´ ì‹œê°„</div>
                            <div class="stat-value" id="finalTime">0ì´ˆ</div>
                        </div>
                    </div>
                </div>
                
                <div class="victory-message">
                    <p>ì¶•í•˜í•©ë‹ˆë‹¤! ì–´íœ˜ ì‹¤ë ¥ì´ ëŒ€ë‹¨í•˜ë„¤ìš”!<br>ë­í‚¹ì— ê¸°ë¡ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
                </div>
                
                <button class="btn primary" id="playAgainBtn">
                    <i class="fas fa-redo"></i> ë‹¤ì‹œí•˜ê¸°
                </button>
                
                <button class="btn secondary" id="viewRankingFromWinBtn" style="margin-top: 8px;">
                    <i class="fas fa-trophy"></i> ë­í‚¹ ë³´ê¸°
                </button>
            </div>
        </div>
        
        <!-- íŒ¨ë°° í™”ë©´ -->
        <div class="overlay result-screen lose-screen">
            <div class="overlay-content">
                <div class="result-header">
                    <div class="result-icon">ğŸ’€</div>
                    <h2>ëŒ€ê²° íŒ¨ë°°</h2>
                    <p class="result-sub">ì²´ë ¥ ì†Œì§„</p>
                </div>
                
                <div class="result-stats">
                    <div class="result-stat">
                        <div class="stat-icon">â­</div>
                        <div class="stat-info">
                            <div class="stat-label">íšë“ ì ìˆ˜</div>
                            <div class="stat-value" id="loseScore">0</div>
                        </div>
                    </div>
                    <div class="result-stat">
                        <div class="stat-icon">ğŸ”¥</div>
                        <div class="stat-info">
                            <div class="stat-label">ìµœê³  ì½¤ë³´</div>
                            <div class="stat-value" id="loseCombo">0</div>
                        </div>
                    </div>
                    <div class="result-stat">
                        <div class="stat-icon">ğŸ¯</div>
                        <div class="stat-info">
                            <div class="stat-label">í´ë¦¬ì–´ ë‹¨ê³„</div>
                            <div class="stat-value" id="loseStage">1/10</div>
                        </div>
                    </div>
                    <div class="result-stat">
                        <div class="stat-icon">âš”ï¸</div>
                        <div class="stat-info">
                            <div class="stat-label">ë‚¨ì€ ëª¬ìŠ¤í„°</div>
                            <div class="stat-value" id="loseMonsters">9ë§ˆë¦¬</div>
                        </div>
                    </div>
                </div>
                
                <div class="defeat-message">
                    <p>ì•„ì‰½ë„¤ìš”! ì–´íœ˜ ì‹¤ë ¥ì„ ë” í‚¤ì›Œì„œ ë‹¤ì‹œ ë„ì „í•˜ì„¸ìš”!<br>ë­í‚¹ì— ê¸°ë¡ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
                </div>
                
                <button class="btn primary" id="restartFromLoseBtn">
                    <i class="fas fa-redo"></i> ë‹¤ì‹œ ë„ì „
                </button>
                
                <button class="btn secondary" id="viewRankingFromLoseBtn" style="margin-top: 8px;">
                    <i class="fas fa-trophy"></i> ë­í‚¹ ë³´ê¸°
                </button>
            </div>
        </div>
        
        <!-- ì´í™íŠ¸ ë ˆì´ì–´ -->
        <div class="effects-layer"></div>
        <div class="damage-layer"></div>
        
    </div>
    
    <!-- ì‚¬ìš´ë“œ ìš”ì†Œë“¤ -->
    <audio id="soundCorrect" preload="auto"><source src="https://assets.mixkit.co/sfx/preview/mixkit-correct-answer-tone-2870.mp3" type="audio/mpeg"></audio>
    <audio id="soundWrong" preload="auto"><source src="https://assets.mixkit.co/sfx/preview/mixkit-wrong-answer-fail-notification-946.mp3" type="audio/mpeg"></audio>
    <audio id="soundDamage" preload="auto"><source src="https://assets.mixkit.co/sfx/preview/mixkit-retro-game-emergency-alarm-1000.mp3" type="audio/mpeg"></audio>
    <audio id="soundHit" preload="auto"><source src="https://assets.mixkit.co/sfx/preview/mixkit-arcade-game-explosion-2759.mp3" type="audio/mpeg"></audio>
    <audio id="soundCombo" preload="auto"><source src="https://assets.mixkit.co/sfx/preview/mixkit-achievement-bell-600.mp3" type="audio/mpeg"></audio>
    <audio id="soundVictory" preload="auto"><source src="https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3" type="audio/mpeg"></audio>
    <audio id="soundPotion" preload="auto"><source src="https://assets.mixkit.co/sfx/preview/mixkit-magic-sparkle-3080.mp3" type="audio/mpeg"></audio>
    
    <!-- ê²Œì„ ë¡œì§ -->
    <script src="game.js"></script>
    
    <!-- Firebase ì„¤ì • ë° ì´ˆê¸°í™” -->
    <script>
    // Firebase êµ¬ì„± ì •ë³´ - gwonjidanwords í”„ë¡œì íŠ¸
    const firebaseConfig = {
        apiKey: "AIzaSyApBB-QuQBOImgysqbfeffYBowEeERYRS4",
        authDomain: "gwonjidanwords.firebaseapp.com",
        databaseURL: "https://gwonjidanwords-default-rtdb.asia-southeast1.firebasedatabase.app/",
        projectId: "gwonjidanwords",
        storageBucket: "gwonjidanwords.firebasestorage.app",
        messagingSenderId: "602593593346",
        appId: "1:602593593346:web:17eeaba9ac91100942ff1b",
        measurementId: "G-GRW0CC74MP"
    };

    // Firebase ì´ˆê¸°í™”
    let firebaseInitialized = false;
    
    try {
        // Firebase ì•± ì´ˆê¸°í™”
        firebase.initializeApp(firebaseConfig);
        console.log("ğŸ”¥ Firebase ì•± ì´ˆê¸°í™” ì„±ê³µ");
        console.log("ğŸ“Š Database URL: https://gwonjidanwords-default-rtdb.asia-southeast1.firebasedatabase.app/");
        
        // Analytics ì´ˆê¸°í™” (ì„ íƒì‚¬í•­)
        const analytics = firebase.analytics();
        console.log("ğŸ“ˆ Firebase Analytics ì´ˆê¸°í™” ì„±ê³µ");
        
        firebaseInitialized = true;
        
        // í˜ì´ì§€ ì¡°íšŒ ì´ë²¤íŠ¸ ì „ì†¡
        analytics.logEvent('page_view', {
            page_title: 'ê¶Œì§€ë‹¨ ì–´íœ˜ëŒ€ì „',
            page_location: window.location.href,
            game_name: 'ê¶Œì§€ë‹¨ ì–´íœ˜ëŒ€ì „'
        });
        
        // ê²Œì„ ì‹œì‘ ì´ë²¤íŠ¸ í•¨ìˆ˜
        window.logGameEvent = function(eventName, eventParams = {}) {
            if (firebaseInitialized) {
                try {
                    analytics.logEvent(eventName, eventParams);
                } catch (error) {
                    console.log("ğŸ“Š ì´ë²¤íŠ¸ ë¡œê¹… ì‹¤íŒ¨:", error);
                }
            }
        };
        
    } catch (error) {
        console.error("âŒ Firebase ì´ˆê¸°í™” ì‹¤íŒ¨:", error);
        firebaseInitialized = false;
    }

    // Firebase ìƒíƒœ í™•ì¸ í•¨ìˆ˜
    window.isFirebaseReady = function() {
        return firebaseInitialized && typeof firebase.database === 'function';
    };

    // Firebase ë°ì´í„°ë² ì´ìŠ¤ ì°¸ì¡° í•¨ìˆ˜
    window.getFirebaseRef = function(path) {
        if (window.isFirebaseReady()) {
            return firebase.database().ref(path);
        }
        return null;
    };
    
    // ë­í‚¹ ì €ì¥ í•¨ìˆ˜
    window.saveRankingToFirebase = async function(rankingData) {
        if (!window.isFirebaseReady()) {
            console.log("âŒ Firebaseê°€ ì¤€ë¹„ë˜ì§€ ì•Šì•„ ë­í‚¹ ì €ì¥ ë¶ˆê°€");
            return false;
        }
        
        try {
            const rankingsRef = firebase.database().ref('rankings');
            const newRankingRef = rankingsRef.push();
            await newRankingRef.set({
                ...rankingData,
                timestamp: firebase.database.ServerValue.TIMESTAMP
            });
            
            console.log("âœ… Firebase ë­í‚¹ ì €ì¥ ì„±ê³µ:", rankingData.nickname, rankingData.score);
            
            // Analytics ì´ë²¤íŠ¸
            if (window.logGameEvent) {
                window.logGameEvent('ranking_saved', {
                    score: rankingData.score,
                    stage: rankingData.stage,
                    nickname_length: rankingData.nickname.length
                });
            }
            
            return true;
        } catch (error) {
            console.error("âŒ Firebase ë­í‚¹ ì €ì¥ ì‹¤íŒ¨:", error);
            return false;
        }
    };
    
    // ë­í‚¹ ì¡°íšŒ í•¨ìˆ˜
    window.loadRankingsFromFirebase = async function(type = 'score', limit = 50) {
        if (!window.isFirebaseReady()) {
            console.log("âŒ Firebaseê°€ ì¤€ë¹„ë˜ì§€ ì•Šì•„ ë­í‚¹ ì¡°íšŒ ë¶ˆê°€");
            return [];
        }
        
        try {
            const rankingsRef = firebase.database().ref('rankings');
            const snapshot = await rankingsRef.orderByChild(type).limitToLast(limit).once('value');
            const data = snapshot.val();
            
            if (data) {
                const rankings = Object.entries(data).map(([key, value]) => ({
                    id: key,
                    ...value
                }));
                
                // ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬
                rankings.sort((a, b) => b[type] - a[type]);
                
                console.log(`âœ… Firebaseì—ì„œ ${rankings.length}ê°œ ë­í‚¹ ë¡œë“œ ì„±ê³µ`);
                return rankings;
            }
            
            return [];
        } catch (error) {
            console.error("âŒ Firebase ë­í‚¹ ì¡°íšŒ ì‹¤íŒ¨:", error);
            return [];
        }
    };
    
    console.log("âœ… Firebase ì„¤ì • ì™„ë£Œ. ìƒíƒœ:", firebaseInitialized ? "í™œì„±í™”" : "ë¹„í™œì„±í™”");
    </script>
    
    <!-- ëª¨ë°”ì¼ ìµœì í™” -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const wordInput = document.getElementById('wordInput');
        const clearBtn = document.getElementById('clearBtn');
        const submitBtn = document.getElementById('submitBtn');
        const potionBtn = document.getElementById('potionBtn');
        
        // ì…ë ¥ ì²˜ë¦¬
        if (wordInput) {
            wordInput.addEventListener('input', function() {
                let text = this.value.replace(/[^ê°€-í£ã„±-ã…]/g, '');
                if (text.length > 2) text = text.slice(0, 2);
                this.value = text;
            });
            
            wordInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    if (window.checkAnswer) window.checkAnswer();
                }
            });
        }
        
        // ë²„íŠ¼ ì´ë²¤íŠ¸
        if (clearBtn) clearBtn.addEventListener('click', function() {
            wordInput.value = '';
            wordInput.focus();
        });
        
        if (submitBtn) submitBtn.addEventListener('click', function() {
            if (window.checkAnswer) window.checkAnswer();
        });
        
        if (potionBtn) potionBtn.addEventListener('click', function() {
            if (window.usePotion) window.usePotion();
        });
        
        // ë‹‰ë„¤ì„ ì…ë ¥ ì²˜ë¦¬
        const nicknameInput = document.getElementById('nicknameInput');
        const nicknameCount = document.getElementById('nicknameCount');
        
        if (nicknameInput && nicknameCount) {
            // ì €ì¥ëœ ë‹‰ë„¤ì„ì´ ìˆìœ¼ë©´ í‘œì‹œ
            const savedNickname = localStorage.getItem('kjd_nickname');
            if (savedNickname) {
                nicknameInput.value = savedNickname;
                nicknameCount.textContent = savedNickname.length;
            }
            
            nicknameInput.addEventListener('input', function() {
                let text = this.value.replace(/[^a-zA-Z0-9ê°€-í£ã„±-ã…ã…-ã…£\s]/g, '');
                if (text.length > 10) text = text.substring(0, 10);
                this.value = text;
                nicknameCount.textContent = text.length;
            });
        }
        
        // ë‹‰ë„¤ì„ ì €ì¥ ë²„íŠ¼
        const saveNicknameBtn = document.getElementById('saveNicknameBtn');
        if (saveNicknameBtn) {
            saveNicknameBtn.addEventListener('click', function() {
                const nickname = nicknameInput.value.trim();
                if (nickname.length > 0) {
                    localStorage.setItem('kjd_nickname', nickname);
                    
                    // ì¥ì¹˜ ID ìƒì„± (ì—†ëŠ” ê²½ìš°ì—ë§Œ)
                    if (!localStorage.getItem('kjd_device_id')) {
                        const deviceId = 'device_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                        localStorage.setItem('kjd_device_id', deviceId);
                    }
                    
                    document.querySelector('.nickname-screen').classList.remove('active');
                    document.querySelector('.start-screen').classList.add('active');
                    
                    // Firebase ì´ë²¤íŠ¸
                    if (window.logGameEvent) {
                        window.logGameEvent('nickname_set', {
                            nickname_length: nickname.length
                        });
                    }
                } else {
                    alert('ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                    nicknameInput.focus();
                }
            });
        }
        
        // ë‹‰ë„¤ì„ ê±´ë„ˆë›°ê¸° ë²„íŠ¼
        const skipNicknameBtn = document.getElementById('skipNicknameBtn');
        if (skipNicknameBtn) {
            skipNicknameBtn.addEventListener('click', function() {
                localStorage.setItem('kjd_nickname', 'ìµëª…');
                
                // ì¥ì¹˜ ID ìƒì„± (ì—†ëŠ” ê²½ìš°ì—ë§Œ)
                if (!localStorage.getItem('kjd_device_id')) {
                    const deviceId = 'device_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                    localStorage.setItem('kjd_device_id', deviceId);
                }
                
                document.querySelector('.nickname-screen').classList.remove('active');
                document.querySelector('.start-screen').classList.add('active');
                
                // Firebase ì´ë²¤íŠ¸
                if (window.logGameEvent) {
                    window.logGameEvent('nickname_skipped');
                }
            });
        }
        
        // ì‹œì‘ ì‹œ ì…ë ¥ í¬ì»¤ìŠ¤
        document.getElementById('startBtn').addEventListener('click', function() {
            setTimeout(() => {
                if (wordInput) {
                    wordInput.focus();
                    wordInput.value = '';
                }
            }, 300);
            
            // Firebase ì´ë²¤íŠ¸
            if (window.logGameEvent) {
                window.logGameEvent('game_start');
            }
        });
        
        // ì¼ì‹œì •ì§€ í•´ì œ ì‹œ ì…ë ¥ í¬ì»¤ìŠ¤
        document.getElementById('resumeBtn').addEventListener('click', function() {
            setTimeout(() => {
                if (wordInput) wordInput.focus();
            }, 300);
        });
        
        // ë­í‚¹ ë²„íŠ¼ ì´ë²¤íŠ¸
        const rankingBtn = document.getElementById('rankingBtn');
        const headerRankingBtn = document.getElementById('headerRankingBtn');
        const viewRankingFromWinBtn = document.getElementById('viewRankingFromWinBtn');
        const viewRankingFromLoseBtn = document.getElementById('viewRankingFromLoseBtn');
        const closeRankingBtn = document.getElementById('closeRankingBtn');
        const refreshRankingBtn = document.getElementById('refreshRankingBtn');
        
        // ë­í‚¹ ë°ì´í„° ë¡œë“œ í•¨ìˆ˜
        async function loadAndDisplayRankings() {
            const rankingList = document.getElementById('rankingList');
            const myRanking = document.getElementById('myRanking');
            
            if (!rankingList) return;
            
            rankingList.innerHTML = `
                <div class="loading-rankings">
                    <i class="fas fa-spinner fa-spin"></i> ë­í‚¹ ë¡œë”© ì¤‘...
                </div>
            `;
            
            try {
                // í™œì„± íƒ­ í™•ì¸
                const activeTab = document.querySelector('.ranking-tab.active');
                const type = activeTab ? activeTab.dataset.type : 'score';
                
                // Firebaseì—ì„œ ë­í‚¹ ë¡œë“œ
                const rankings = await window.loadRankingsFromFirebase(type, 10);
                
                if (rankings.length === 0) {
                    rankingList.innerHTML = `
                        <div class="no-rankings">
                            <i class="fas fa-trophy"></i>
                            <p>ë­í‚¹ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</p>
                            <p class="sub">ê²Œì„ì„ í”Œë ˆì´í•˜ë©´ ë­í‚¹ì— ë“±ë¡ë©ë‹ˆë‹¤!</p>
                        </div>
                    `;
                    return;
                }
                
                // í˜„ì¬ ì‚¬ìš©ì ì •ë³´
                const currentDeviceId = localStorage.getItem('kjd_device_id');
                const currentNickname = localStorage.getItem('kjd_nickname') || 'ìµëª…';
                
                // ë‚´ ë­í‚¹ ì°¾ê¸°
                let myRankIndex = -1;
                let myRankData = null;
                
                for (let i = 0; i < rankings.length; i++) {
                    if (rankings[i].deviceId === currentDeviceId) {
                        myRankIndex = i;
                        myRankData = rankings[i];
                        break;
                    }
                }
                
                // ë­í‚¹ ëª©ë¡ ë Œë”ë§
                let rankingHTML = '';
                for (let i = 0; i < Math.min(rankings.length, 10); i++) {
                    const rank = rankings[i];
                    const isMe = rank.deviceId === currentDeviceId;
                    
                    let rankValue = '';
                    switch(type) {
                        case 'score': rankValue = rank.score.toLocaleString() + 'ì '; break;
                        case 'stage': rankValue = rank.stage + 'ë‹¨ê³„'; break;
                        case 'combo': rankValue = rank.maxCombo + 'ì½¤ë³´'; break;
                    }
                    
                    rankingHTML += `
                        <div class="ranking-item ${isMe ? 'my-rank' : ''}">
                            <div class="rank-position ${i < 3 ? 'top-' + (i+1) : ''}">${i + 1}</div>
                            <div class="rank-info">
                                <div class="rank-name ${isMe ? 'me' : ''}">${rank.nickname}</div>
                                <div class="rank-details">
                                    <div class="rank-stat">
                                        <i class="fas fa-${type === 'score' ? 'star' : type === 'stage' ? 'gamepad' : 'fire'}"></i>
                                        ${rankValue}
                                    </div>
                                    <div class="rank-stat">
                                        <i class="fas fa-check-circle"></i>
                                        ì •í™•ë„: ${rank.accuracy || 0}%
                                    </div>
                                    <div class="rank-stat">
                                        <i class="fas fa-clock"></i>
                                        ${Math.floor(rank.gameTime / 60)}ë¶„
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }
                
                rankingList.innerHTML = rankingHTML;
                
                // ë‚´ ë­í‚¹ ì •ë³´ í‘œì‹œ
                if (myRankData) {
                    let myRankValue = '';
                    switch(type) {
                        case 'score': myRankValue = myRankData.score.toLocaleString() + 'ì '; break;
                        case 'stage': myRankValue = myRankData.stage + 'ë‹¨ê³„'; break;
                        case 'combo': myRankValue = myRankData.maxCombo + 'ì½¤ë³´'; break;
                    }
                    
                    myRanking.innerHTML = `
                        <div class="my-ranking-header">ë‚´ ë­í‚¹ (${myRankIndex + 1}ìœ„)</div>
                        <div class="my-ranking-info">
                            <div class="my-rank-position">${myRankIndex + 1}</div>
                            <div class="my-rank-details">
                                <div class="my-rank-name">${myRankData.nickname}</div>
                                <div class="my-rank-score">${myRankValue} â€¢ ì •í™•ë„: ${myRankData.accuracy || 0}% â€¢ ${Math.floor(myRankData.gameTime / 60)}ë¶„</div>
                            </div>
                        </div>
                    `;
                } else {
                    myRanking.innerHTML = `
                        <div class="my-ranking-header">ë‚´ ë­í‚¹</div>
                        <div class="my-ranking-info">
                            <div class="my-rank-details">
                                <div class="my-rank-name">${currentNickname}</div>
                                <div class="my-rank-score">ì•„ì§ ë­í‚¹ì— ë“±ë¡ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤</div>
                            </div>
                        </div>
                    `;
                }
                
                // Firebase ì´ë²¤íŠ¸
                if (window.logGameEvent) {
                    window.logGameEvent('ranking_viewed', {
                        ranking_type: type,
                        ranking_count: rankings.length
                    });
                }
                
            } catch (error) {
                console.error('ë­í‚¹ ë¡œë“œ ì‹¤íŒ¨:', error);
                rankingList.innerHTML = `
                    <div class="no-rankings">
                        <i class="fas fa-exclamation-triangle"></i>
                        <p>ë­í‚¹ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤</p>
                        <p class="sub">ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”</p>
                    </div>
                `;
            }
        }
        
        function showRankingScreen() {
            document.querySelectorAll('.overlay').forEach(overlay => {
                overlay.classList.remove('active');
            });
            document.querySelector('.ranking-screen').classList.add('active');
            
            // ë­í‚¹ ë°ì´í„° ë¡œë“œ
            loadAndDisplayRankings();
        }
        
        function closeRankingScreen() {
            document.querySelector('.ranking-screen').classList.remove('active');
            document.querySelector('.start-screen').classList.add('active');
        }
        
        if (rankingBtn) rankingBtn.addEventListener('click', showRankingScreen);
        if (headerRankingBtn) headerRankingBtn.addEventListener('click', showRankingScreen);
        if (viewRankingFromWinBtn) viewRankingFromWinBtn.addEventListener('click', showRankingScreen);
        if (viewRankingFromLoseBtn) viewRankingFromLoseBtn.addEventListener('click', showRankingScreen);
        if (closeRankingBtn) closeRankingBtn.addEventListener('click', closeRankingScreen);
        
        // ë­í‚¹ ìƒˆë¡œê³ ì¹¨
        if (refreshRankingBtn) {
            refreshRankingBtn.addEventListener('click', loadAndDisplayRankings);
        }
        
        // ë­í‚¹ íƒ­ ì „í™˜
        document.querySelectorAll('.ranking-tab').forEach(tab => {
            tab.addEventListener('click', function() {
                // ëª¨ë“  íƒ­ ë¹„í™œì„±í™”
                document.querySelectorAll('.ranking-tab').forEach(t => {
                    t.classList.remove('active');
                });
                // í˜„ì¬ íƒ­ í™œì„±í™”
                this.classList.add('active');
                
                // ë­í‚¹ ë°ì´í„° ë‹¤ì‹œ ë¡œë“œ
                loadAndDisplayRankings();
            });
        });
        
        // í‚¤ë³´ë“œ ê°ì§€
        window.addEventListener('resize', function() {
            if (window.innerHeight < window.outerHeight * 0.7) {
                document.body.classList.add('keyboard-open');
            } else {
                document.body.classList.remove('keyboard-open');
            }
        });
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ë‹‰ë„¤ì„ í™•ì¸
        setTimeout(() => {
            const savedNickname = localStorage.getItem('kjd_nickname');
            const savedDeviceId = localStorage.getItem('kjd_device_id');
            
            if (!savedNickname || !savedDeviceId) {
                // ë‹‰ë„¤ì„ì´ ì—†ìœ¼ë©´ ë‹‰ë„¤ì„ í™”ë©´ í‘œì‹œ
                document.querySelector('.start-screen').classList.remove('active');
                document.querySelector('.nickname-screen').classList.add('active');
            }
        }, 500);
    });
    </script>
</body>
</html>